module.exports=[46820,a=>{"use strict";var b=a.i(79393),c=a.i(25602),d=a.i(54347),e=a.i(39793),f=a.i(91302),g=a.i(14727),h=a.i(40695),i=a.i(54161),j=a.i(88237),k=a.i(5522),l=a.i(17171),m=a.i(65733),n=a.i(87682),o=a.i(59653),p=a.i(82383),q=a.i(90788),r=a.i(37963),s=a.i(79690),t=a.i(84495),u=a.i(60632),v="Switch",[w,x]=(0,q.createContextScope)(v),[y,z]=w(v),A=c.forwardRef((a,d)=>{let{__scopeSwitch:e,name:f,checked:g,defaultChecked:h,required:i,disabled:j,value:k="on",onCheckedChange:l,form:m,...n}=a,[q,s]=c.useState(null),t=(0,p.useComposedRefs)(d,a=>s(a)),w=c.useRef(!1),x=!q||m||!!q.closest("form"),[z,A]=(0,r.useControllableState)({prop:g,defaultProp:h??!1,onChange:l,caller:v});return(0,b.jsxs)(y,{scope:e,checked:z,disabled:j,children:[(0,b.jsx)(u.Primitive.button,{type:"button",role:"switch","aria-checked":z,"aria-required":i,"data-state":E(z),"data-disabled":j?"":void 0,disabled:j,value:k,...n,ref:t,onClick:(0,o.composeEventHandlers)(a.onClick,a=>{A(a=>!a),x&&(w.current=a.isPropagationStopped(),w.current||a.stopPropagation())})}),x&&(0,b.jsx)(D,{control:q,bubbles:!w.current,name:f,value:k,checked:z,required:i,disabled:j,form:m,style:{transform:"translateX(-100%)"}})]})});A.displayName=v;var B="SwitchThumb",C=c.forwardRef((a,c)=>{let{__scopeSwitch:d,...e}=a,f=z(B,d);return(0,b.jsx)(u.Primitive.span,{"data-state":E(f.checked),"data-disabled":f.disabled?"":void 0,...e,ref:c})});C.displayName=B;var D=c.forwardRef(({__scopeSwitch:a,control:d,checked:e,bubbles:f=!0,...g},h)=>{let i=c.useRef(null),j=(0,p.useComposedRefs)(i,h),k=(0,s.usePrevious)(e),l=(0,t.useSize)(d);return c.useEffect(()=>{let a=i.current;if(!a)return;let b=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(k!==e&&b){let c=new Event("click",{bubbles:f});b.call(a,e),a.dispatchEvent(c)}},[k,e,f]),(0,b.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:e,...g,tabIndex:-1,ref:j,style:{...g.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function E(a){return a?"checked":"unchecked"}D.displayName="SwitchBubbleInput";var F=a.i(97895);function G({className:a,...c}){return(0,b.jsx)(A,{"data-slot":"switch",className:(0,F.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...c,children:(0,b.jsx)(C,{"data-slot":"switch-thumb",className:(0,F.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}var H=a.i(46143),I=a.i(37258),J=a.i(53250);function K(){let a=(0,d.useRouter)(),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(0),[u,v]=(0,c.useState)(1),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(void 0),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)("create"),[K,L]=(0,c.useState)(null),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)(null),[Q,R]=(0,c.useState)(!1),[S,T]=(0,c.useState)({username:"",is_super_admin:!1,status:1,role_ids:[],permission_ids:[]}),[U,V]=(0,c.useState)(!1);(0,c.useEffect)(()=>{if(!(0,J.getAccessToken)())return void a.push("/login")},[a]);let W=async()=>{r(!0);try{let a=await (0,J.getAdmins)({page:u,page_size:20,keyword:w||void 0,status:y});p(a.list),t(a.total)}catch(a){a instanceof J.ApiError?I.toast.error(a.message||"获取管理员列表失败"):I.toast.error("发生未知错误，请稍后重试")}finally{r(!1)}};(0,c.useEffect)(()=>{(0,J.getAccessToken)()&&(W(),X())},[u,y]);let X=async()=>{try{let a=await (0,J.getRoles)({page:1,page_size:1e3});B(a.list)}catch(a){a instanceof J.ApiError?I.toast.error(a.message||"获取角色列表失败"):I.toast.error("发生未知错误，请稍后重试")}},Y=async(a,b)=>{if(confirm(`确定要删除管理员 "${b}" 吗？`))try{await (0,J.deleteAdmin)(a),I.toast.success("删除成功"),W()}catch(a){a instanceof J.ApiError?I.toast.error(a.message||"删除失败"):I.toast.error("发生未知错误，请稍后重试")}},Z=async a=>{N(!0),R(!0),P(null);try{let b=await (0,J.getAdmin)(a.id);P(b)}catch(a){a instanceof J.ApiError?I.toast.error(a.message||"获取管理员详情失败"):I.toast.error("发生未知错误，请稍后重试")}finally{R(!1)}},$=async a=>{F("edit"),L(a),V(!0);try{let b=await (0,J.getAdmin)(a.id),c=b.roles?.map(a=>a.id)||[];T({username:b.username,is_super_admin:b.is_super_admin,status:b.status,role_ids:c,permission_ids:[]}),D(!0)}catch(a){a instanceof J.ApiError?I.toast.error(a.message||"获取管理员详情失败"):I.toast.error("发生未知错误，请稍后重试")}finally{V(!1)}},_=async a=>{if(a.preventDefault(),!S.username)return void I.toast.error("用户名不能为空");if(S.username.length<3)return void I.toast.error("用户名长度至少为 3 位");V(!0);try{if("create"===E){if(!S.password){I.toast.error("密码不能为空"),V(!1);return}if(S.password.length<6){I.toast.error("密码长度至少为 6 位"),V(!1);return}await (0,J.createAdmin)({username:S.username,password:S.password,is_super_admin:S.is_super_admin,role_ids:S.role_ids}),I.toast.success("创建成功")}else if("edit"===E&&K){let a={status:S.status};if(S.password){if(S.password.length<6){I.toast.error("密码长度至少为 6 位"),V(!1);return}a.password=S.password}await (0,J.updateAdmin)(K.id,a),!S.is_super_admin&&S.role_ids&&await (0,J.assignRolesToAdmin)(K.id,S.role_ids),I.toast.success("更新成功")}D(!1),T({username:"",is_super_admin:!1,status:1,role_ids:[],permission_ids:[]}),W()}catch(a){a instanceof J.ApiError?I.toast.error(a.message||("create"===E?"创建失败":"更新失败")):I.toast.error("发生未知错误，请稍后重试")}finally{V(!1)}},aa=Math.ceil(s/20);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(g.SidebarProvider,{style:{"--sidebar-width":"calc(var(--spacing) * 72)","--header-height":"calc(var(--spacing) * 12)"},children:[(0,b.jsx)(e.AppSidebar,{variant:"inset"}),(0,b.jsxs)(g.SidebarInset,{children:[(0,b.jsx)(f.SiteHeader,{}),(0,b.jsx)("div",{className:"flex flex-1 flex-col",children:(0,b.jsx)("div",{className:"@container/main flex flex-1 flex-col gap-2",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 px-4 py-4 lg:px-6 lg:py-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold",children:"管理员管理"}),(0,b.jsx)(h.Button,{onClick:()=>{F("create"),L(null),T({username:"",is_super_admin:!1,status:1,role_ids:[],permission_ids:[]}),D(!0)},children:"添加管理员"})]}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"keyword",children:"搜索"}),(0,b.jsx)(k.Input,{id:"keyword",value:w,onChange:a=>x(a.target.value),placeholder:"用户名",className:"w-48"}),(0,b.jsx)(h.Button,{onClick:()=>{v(1),W()},disabled:q,children:"搜索"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"status",children:"状态"}),(0,b.jsxs)(n.Select,{value:y?.toString(),onValueChange:a=>z(a?Number(a):void 0),children:[(0,b.jsx)(n.SelectTrigger,{className:"w-32",children:(0,b.jsx)(n.SelectValue,{placeholder:"全部"})}),(0,b.jsxs)(n.SelectContent,{children:[(0,b.jsx)(n.SelectItem,{value:"1",children:"正常"}),(0,b.jsx)(n.SelectItem,{value:"0",children:"禁用"})]})]})]})]}),(0,b.jsx)("div",{className:"rounded-lg border",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"用户名"}),(0,b.jsx)(j.TableHead,{children:"类型"}),(0,b.jsx)(j.TableHead,{children:"状态"}),(0,b.jsx)(j.TableHead,{children:"操作"})]})}),(0,b.jsx)(j.TableBody,{children:q?(0,b.jsx)(j.TableRow,{children:(0,b.jsx)(j.TableCell,{colSpan:4,className:"text-center",children:"加载中..."})}):0===o.length?(0,b.jsx)(j.TableRow,{children:(0,b.jsx)(j.TableCell,{colSpan:4,className:"text-center",children:"暂无数据"})}):o.map(a=>(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"font-medium",children:a.username}),(0,b.jsx)(j.TableCell,{children:a.is_super_admin?(0,b.jsx)(i.Badge,{variant:"default",children:"超级管理员"}):(0,b.jsx)(i.Badge,{variant:"secondary",children:"管理员"})}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(i.Badge,{variant:1===a.status?"default":"destructive",children:1===a.status?"正常":"禁用"})}),(0,b.jsx)(j.TableCell,{children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>Z(a),children:"详情"}),(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>$(a),children:"编辑"}),(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>Y(a.id,a.username),children:"删除"})]})})]},a.id))})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["共 ",s," 条记录，当前第 ",u," / ",aa," 页"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>v(a=>Math.max(1,a-1)),disabled:q||u<=1,children:"上一页"}),(0,b.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>v(a=>Math.min(aa,a+1)),disabled:q||u>=aa,children:"下一页"})]})]})]})})})]})]}),(0,b.jsx)(m.Dialog,{open:M,onOpenChange:N,children:(0,b.jsxs)(m.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(m.DialogHeader,{children:[(0,b.jsx)(m.DialogTitle,{children:"管理员详情"}),(0,b.jsx)(m.DialogDescription,{children:"查看管理员的完整信息和角色绑定关系"})]}),Q?(0,b.jsx)("div",{className:"py-8 text-center",children:"加载中..."}):O?(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground",children:"用户名"}),(0,b.jsx)("div",{className:"font-medium",children:O.username})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground",children:"类型"}),(0,b.jsx)("div",{children:O.is_super_admin?(0,b.jsx)(i.Badge,{variant:"default",children:"超级管理员"}):(0,b.jsx)(i.Badge,{variant:"secondary",children:"管理员"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground",children:"状态"}),(0,b.jsx)("div",{children:(0,b.jsx)(i.Badge,{variant:1===O.status?"default":"destructive",children:1===O.status?"正常":"禁用"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground",children:"最后登录"}),(0,b.jsx)("div",{children:O.last_login_at?new Date(O.last_login_at).toLocaleString("zh-CN"):"未登录"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground",children:"登录失败次数"}),(0,b.jsx)("div",{children:void 0!==O.login_attempts?O.login_attempts:0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground",children:"锁定状态"}),(0,b.jsx)("div",{children:O.locked_until?new Date(O.locked_until).toLocaleString("zh-CN"):"未锁定"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground",children:"创建时间"}),(0,b.jsx)("div",{children:new Date(O.created_at).toLocaleString("zh-CN")})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground",children:"更新时间"}),(0,b.jsx)("div",{children:O.updated_at?new Date(O.updated_at).toLocaleString("zh-CN"):"-"})]})]}),!O.is_super_admin&&(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground mb-2 block",children:"绑定角色"}),(0,b.jsx)("div",{className:"rounded-md border p-4",children:O.roles&&O.roles.length>0?(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:O.roles.map(a=>(0,b.jsxs)(i.Badge,{variant:"outline",children:[a.name," (",a.code,")"]},a.id))}):(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"暂无绑定角色"})})]})]}):null,(0,b.jsx)(m.DialogFooter,{children:(0,b.jsx)(h.Button,{onClick:()=>N(!1),children:"关闭"})})]})}),(0,b.jsx)(m.Dialog,{open:C,onOpenChange:D,children:(0,b.jsxs)(m.DialogContent,{children:[(0,b.jsxs)(m.DialogHeader,{children:[(0,b.jsx)(m.DialogTitle,{children:"create"===E?"添加管理员":"编辑管理员"}),(0,b.jsx)(m.DialogDescription,{children:"create"===E?"请填写管理员信息":"请更新管理员信息"})]}),(0,b.jsxs)("form",{onSubmit:_,children:[(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"username",children:"用户名 *"}),(0,b.jsx)(k.Input,{id:"username",value:S.username,onChange:a=>T({...S,username:a.target.value}),placeholder:"请输入用户名（至少 3 位）",required:!0,disabled:U||"edit"===E})]}),"create"===E&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"password",children:"密码 *"}),(0,b.jsx)(k.Input,{id:"password",type:"password",value:S.password||"",onChange:a=>T({...S,password:a.target.value}),placeholder:"请输入密码（至少 6 位）",required:!0,disabled:U})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"is_super_admin",children:"超级管理员"}),(0,b.jsx)(G,{id:"is_super_admin",checked:S.is_super_admin,onCheckedChange:a=>T({...S,is_super_admin:a}),disabled:U})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"status",children:"状态"}),(0,b.jsxs)(n.Select,{value:S.status.toString(),onValueChange:a=>T({...S,status:Number(a)}),children:[(0,b.jsx)(n.SelectTrigger,{className:"w-full",children:(0,b.jsx)(n.SelectValue,{})}),(0,b.jsxs)(n.SelectContent,{children:[(0,b.jsx)(n.SelectItem,{value:"1",children:"正常"}),(0,b.jsx)(n.SelectItem,{value:"0",children:"禁用"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{children:"角色"}),(0,b.jsxs)("div",{className:"rounded-md border p-4 max-h-48 overflow-y-auto",children:[A.map(a=>(0,b.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,b.jsx)(H.Checkbox,{id:`role-${a.id}`,checked:S.role_ids?.includes(a.id)||!1,onCheckedChange:b=>{let c=b?[...S.role_ids||[],a.id]:(S.role_ids||[]).filter(b=>b!==a.id);T({...S,role_ids:c})},disabled:U||S.is_super_admin}),(0,b.jsxs)("label",{htmlFor:`role-${a.id}`,className:"text-sm",children:[a.name," (",a.code,")"]})]},a.id)),0===A.length&&(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"暂无角色"})]}),S.is_super_admin&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"超级管理员不需要分配角色"})]})]}),(0,b.jsxs)(m.DialogFooter,{children:[(0,b.jsx)(h.Button,{type:"button",variant:"outline",onClick:()=>D(!1),disabled:U,children:"取消"}),(0,b.jsx)(h.Button,{type:"submit",disabled:U,children:U?"create"===E?"创建中...":"更新中...":"create"===E?"确认创建":"确认更新"})]})]})]})})]})}a.s(["default",()=>K],46820)}];

//# sourceMappingURL=app_admins_page_tsx_3f6d6c5b._.js.map