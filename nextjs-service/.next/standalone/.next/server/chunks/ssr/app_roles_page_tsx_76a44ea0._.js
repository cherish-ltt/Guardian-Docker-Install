module.exports=[1093,a=>{"use strict";var b=a.i(79393),c=a.i(25602),d=a.i(54347),e=a.i(39793),f=a.i(91302),g=a.i(14727),h=a.i(40695),i=a.i(54161),j=a.i(88237),k=a.i(5522),l=a.i(17171),m=a.i(65733),n=a.i(46143),o=a.i(37258),p=a.i(53250);function q(){let a=(0,d.useRouter)(),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(0),[w,x]=(0,c.useState)(1),[y,z]=(0,c.useState)(20),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)("create"),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(null),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)({code:"",name:"",description:""}),[S,T]=(0,c.useState)(!1);(0,c.useEffect)(()=>{if(!(0,p.getAccessToken)())return void a.push("/login")},[a]);let U=async()=>{try{let a=await (0,p.getPermissionsTree)();D(a)}catch(a){a instanceof p.ApiError?o.toast.error(a.message||"获取权限树失败"):o.toast.error("发生未知错误，请稍后重试")}};(0,c.useEffect)(()=>{(0,p.getAccessToken)()&&U()},[]);let V=async()=>{t(!0);try{let a=await (0,p.getRoles)({page:w,page_size:y,keyword:A||void 0});r(a.list),v(a.total)}catch(a){a instanceof p.ApiError?o.toast.error(a.message||"获取角色列表失败"):o.toast.error("发生未知错误，请稍后重试")}finally{t(!1)}};(0,c.useEffect)(()=>{(0,p.getAccessToken)()&&V()},[w,y,A]);let W=async a=>{L(!0),P(!0),N(null);try{let b=await (0,p.getRole)(a.id);N(b)}catch(a){a instanceof p.ApiError?o.toast.error(a.message||"获取角色详情失败"):o.toast.error("发生未知错误，请稍后重试")}finally{P(!1)}},X=async(a,b)=>{if(confirm(`确定要删除角色 "${b}" 吗？`))try{await (0,p.deleteRole)(a),o.toast.success("删除成功"),V()}catch(a){a instanceof p.ApiError?o.toast.error(a.message||"删除失败"):o.toast.error("发生未知错误，请稍后重试")}},Y=async a=>{H("edit"),J(a),T(!0);try{let b=await (0,p.getRole)(a.id),c=b.permissions?.map(a=>a.id)||[];R({code:b.code,name:b.name,description:b.description||"",permission_ids:c}),F(!0)}catch(a){a instanceof p.ApiError?o.toast.error(a.message||"获取角色详情失败"):o.toast.error("发生未知错误，请稍后重试")}finally{T(!1)}},Z=async a=>{if(a.preventDefault(),!Q.code)return void o.toast.error("角色代码不能为空");if(!Q.name)return void o.toast.error("角色名称不能为空");if(Q.code.length<2)return void o.toast.error("角色代码至少为 2 位");if(Q.name.length<2)return void o.toast.error("角色名称至少为 2 个字符");T(!0);try{"create"===G?(await (0,p.createRole)({code:Q.code,name:Q.name,description:Q.description}),o.toast.success("创建成功")):"edit"===G&&I&&(await (0,p.updateRole)(I.id,{code:Q.code,name:Q.name,description:Q.description}),Q.permission_ids&&await (0,p.assignPermissionsToRole)(I.id,Q.permission_ids),o.toast.success("更新成功")),F(!1),R({code:"",name:"",description:"",permission_ids:[]}),V()}catch(a){a instanceof p.ApiError?o.toast.error(a.message||("create"===G?"创建失败":"更新失败")):o.toast.error("发生未知错误，请稍后重试")}finally{T(!1)}},$=Math.ceil(u/y);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(g.SidebarProvider,{style:{"--sidebar-width":"calc(var(--spacing) * 72)","--header-height":"calc(var(--spacing) * 12)"},children:[(0,b.jsx)(e.AppSidebar,{variant:"inset"}),(0,b.jsxs)(g.SidebarInset,{children:[(0,b.jsx)(f.SiteHeader,{}),(0,b.jsx)("div",{className:"flex flex-1 flex-col",children:(0,b.jsx)("div",{className:"@container/main flex flex-1 flex-col gap-2",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 px-4 py-4 lg:px-6 lg:py-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold",children:"角色管理"}),(0,b.jsx)(h.Button,{onClick:()=>{H("create"),J(null),R({code:"",name:"",description:"",permission_ids:[]}),F(!0)},children:"添加角色"})]}),(0,b.jsx)("div",{className:"flex gap-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"keyword",children:"搜索"}),(0,b.jsx)(k.Input,{id:"keyword",value:A,onChange:a=>B(a.target.value),placeholder:"角色代码或名称",className:"w-48"}),(0,b.jsx)(h.Button,{onClick:()=>{x(1),V()},disabled:s,children:"搜索"})]})}),(0,b.jsx)("div",{className:"rounded-lg border",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"角色代码"}),(0,b.jsx)(j.TableHead,{children:"角色名称"}),(0,b.jsx)(j.TableHead,{children:"类型"}),(0,b.jsx)(j.TableHead,{children:"操作"})]})}),(0,b.jsx)(j.TableBody,{children:s?(0,b.jsx)(j.TableRow,{children:(0,b.jsx)(j.TableCell,{colSpan:4,className:"text-center",children:"加载中..."})}):0===q.length?(0,b.jsx)(j.TableRow,{children:(0,b.jsx)(j.TableCell,{colSpan:4,className:"text-center",children:"暂无数据"})}):q.map(a=>(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"font-medium",children:a.code}),(0,b.jsx)(j.TableCell,{children:a.name}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(i.Badge,{variant:a.is_system?"default":"secondary",children:a.is_system?"系统角色":"自定义"})}),(0,b.jsx)(j.TableCell,{children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>W(a),children:"详情"}),(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>Y(a),children:"编辑"}),(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>X(a.id,a.name),children:"删除"})]})})]},a.id))})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["共 ",u," 条记录，当前第 ",w," / ",$," 页"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>x(a=>Math.max(1,a-1)),disabled:s||w<=1,children:"上一页"}),(0,b.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>x(a=>Math.min($,a+1)),disabled:s||w>=$,children:"下一页"})]})]})]})})})]})]}),(0,b.jsx)(m.Dialog,{open:K,onOpenChange:L,children:(0,b.jsxs)(m.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(m.DialogHeader,{children:[(0,b.jsx)(m.DialogTitle,{children:"角色详情"}),(0,b.jsx)(m.DialogDescription,{children:"查看角色的完整信息和权限绑定关系"})]}),O?(0,b.jsx)("div",{className:"py-8 text-center",children:"加载中..."}):M?(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground",children:"角色代码"}),(0,b.jsx)("div",{className:"font-medium",children:M.code})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground",children:"角色名称"}),(0,b.jsx)("div",{children:M.name})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground",children:"类型"}),(0,b.jsx)("div",{children:(0,b.jsx)(i.Badge,{variant:M.is_system?"default":"secondary",children:M.is_system?"系统角色":"自定义"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground",children:"描述"}),(0,b.jsx)("div",{children:M.description||"-"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground",children:"创建时间"}),(0,b.jsx)("div",{children:new Date(M.created_at).toLocaleString("zh-CN")})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground",children:"更新时间"}),(0,b.jsx)("div",{children:new Date(M.updated_at).toLocaleString("zh-CN")})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground mb-2 block",children:"绑定权限"}),(0,b.jsx)("div",{className:"rounded-md border p-4 max-h-64 overflow-y-auto",children:M.permissions&&M.permissions.length>0?(0,b.jsx)("div",{className:"space-y-2",children:M.permissions.map(a=>(0,b.jsxs)("div",{className:"text-sm",children:[a.name," (",a.code,")"]},a.id))}):(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"暂无绑定权限"})})]})]}):null,(0,b.jsx)(m.DialogFooter,{children:(0,b.jsx)(h.Button,{onClick:()=>L(!1),children:"关闭"})})]})}),(0,b.jsx)(m.Dialog,{open:E,onOpenChange:F,children:(0,b.jsxs)(m.DialogContent,{children:[(0,b.jsxs)(m.DialogHeader,{children:[(0,b.jsx)(m.DialogTitle,{children:"create"===G?"添加角色":"编辑角色"}),(0,b.jsx)(m.DialogDescription,{children:"create"===G?"请填写角色信息":"请更新角色信息"})]}),(0,b.jsxs)("form",{onSubmit:Z,children:[(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"code",children:"角色代码 *"}),(0,b.jsx)(k.Input,{id:"code",value:Q.code,onChange:a=>R({...Q,code:a.target.value}),placeholder:"请输入角色代码（如 ADMIN, USER）",required:!0,disabled:S||"edit"===G,maxLength:50})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"name",children:"角色名称 *"}),(0,b.jsx)(k.Input,{id:"name",value:Q.name,onChange:a=>R({...Q,name:a.target.value}),placeholder:"请输入角色名称",required:!0,disabled:S,maxLength:100})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"description",children:"描述"}),(0,b.jsx)(k.Input,{id:"description",value:Q.description,onChange:a=>R({...Q,description:a.target.value}),placeholder:"请输入角色描述（可选）",disabled:S,maxLength:200})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{children:"权限"}),(0,b.jsx)("div",{className:"rounded-md border p-4 max-h-64 overflow-y-auto",children:C.length>0?function a(c,d,e,f,g=0){return c.map(c=>(0,b.jsxs)("div",{style:{marginLeft:20*g},children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,b.jsx)(n.Checkbox,{id:`permission-${c.id}`,checked:d.permission_ids?.includes(c.id)||!1,onCheckedChange:a=>{let b=a?[...d.permission_ids||[],c.id]:(d.permission_ids||[]).filter(a=>a!==c.id);e({...d,permission_ids:b})},disabled:f}),(0,b.jsxs)("label",{htmlFor:`permission-${c.id}`,className:"text-sm flex-1",children:[c.name," (",c.code,")"]})]}),c.children&&c.children.length>0&&a(c.children,d,e,f,g+1)]},c.id))}(C,Q,R,S):(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"暂无权限"})})]})]}),(0,b.jsxs)(m.DialogFooter,{children:[(0,b.jsx)(h.Button,{type:"button",variant:"outline",onClick:()=>F(!1),disabled:S,children:"取消"}),(0,b.jsx)(h.Button,{type:"submit",disabled:S,children:S?"create"===G?"创建中...":"更新中...":"create"===G?"确认创建":"确认更新"})]})]})]})})]})}a.s(["default",()=>q])}];

//# sourceMappingURL=app_roles_page_tsx_76a44ea0._.js.map