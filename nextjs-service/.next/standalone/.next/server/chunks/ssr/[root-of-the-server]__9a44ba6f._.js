module.exports=[98953,(a,b,c)=>{"use strict";b.exports=a.r(16232).vendored.contexts.AppRouterContext},52529,(a,b,c)=>{"use strict";b.exports=a.r(16232).vendored.contexts.HooksClientContext},88950,(a,b,c)=>{"use strict";b.exports=a.r(16232).vendored.contexts.ServerInsertedHtml},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},79393,(a,b,c)=>{"use strict";b.exports=a.r(16232).vendored["react-ssr"].ReactJsxRuntime},53250,38847,a=>{"use strict";let b="/guardian-auth/v1",c={LOGIN:"/auth/login",LOGOUT:"/auth/logout",REFRESH:"/auth/refresh",TWO_FACTOR_SETUP:"/auth/2fa/setup",TWO_FACTOR_VERIFY:"/auth/2fa/verify",TWO_FACTOR_DISABLE:"/auth/2fa/disable",CHANGE_PASSWORD:"/auth/change-password",RESET_PASSWORD:"/auth/reset-password",SYSTEM_INFO:"/systeminfo",ADMINS:"/admins",ROLES:"/roles",PERMISSIONS:"/permissions",PERMISSIONS_TREE:"/permissions/tree"};a.s(["API_BASE_URL",0,b,"API_ENDPOINTS",0,c],38847);class d extends Error{code;data;constructor(a,b,c){super(b),this.code=a,this.data=c,this.name="ApiError"}}let e=!1,f=null;function g(){return null}function h(a){}function i(a){}function j(){}function k(){}async function l(){throw Error("No refresh token available")}async function m(a){let b=a.headers.get("content-type");if(!a.ok){let b=a.status,c="出错啦！请稍后再试。";try{let b=await a.json();b.msg&&""!==b.msg.trim()&&(c=b.msg)}catch{}throw new d(b,c)}if(!b||!b.includes("application/json"))throw new d(0,"Invalid response format");let c=await a.json();if(200!==c.code){let a=c.msg&&""!==c.msg.trim()?c.msg:"出错啦！请稍后再试。";throw new d(c.code,a,c.data)}return c.data}async function n(a,b,c){let g=a.headers.get("content-type");if(!a.ok){let b=a.status,c="出错啦！请稍后再试。";try{let b=await a.json();b.msg&&""!==b.msg.trim()&&(c=b.msg)}catch{}throw new d(b,c)}if(!g||!g.includes("application/json"))throw new d(0,"Invalid response format");let h=await a.json();if(17003===h.code||17002===h.code)try{let a="";e?a=await f:(e=!0,f=l(),a=await f,f=null,e=!1);let d=await fetch(b,{...c,headers:{...c.headers,Authorization:`Bearer ${a}`}});return m(d)}catch{throw new d(h.code,"Session expired, please login again")}if(200!==h.code){let a=h.msg&&""!==h.msg.trim()?h.msg:"出错啦！请稍后再试。";throw new d(h.code,a,h.data)}return h.data}async function o(a,c){let d=`${b}${a}`,e={"Content-Type":"application/json",...c?.headers};return m(await fetch(d,{...c,headers:e}))}async function p(a,b){return o(a,{method:"POST",body:b?JSON.stringify(b):void 0})}async function q(a,c){let d=g(),e=`${b}${a}`,f={method:"POST",body:c?JSON.stringify(c):void 0,headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}};return n(await fetch(e,f),e,f)}async function r(a){let c=g(),d=`${b}${a}`,e={method:"GET",headers:{Authorization:`Bearer ${c}`}};return n(await fetch(d,e),d,e)}async function s(a,c){let d=g(),e=`${b}${a}`,f={method:"PUT",body:c?JSON.stringify(c):void 0,headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}};return n(await fetch(e,f),e,f)}async function t(a){let c=g(),d=`${b}${a}`,e={method:"DELETE",headers:{Authorization:`Bearer ${c}`}};return n(await fetch(d,e),d,e)}async function u(a){let b=a?`?limit=${a}`:"";return r(`${c.SYSTEM_INFO}${b}`)}async function v(a){return q(c.CHANGE_PASSWORD,{new_password:a})}async function w(a,b,d){return p(c.RESET_PASSWORD,{username:a,two_fa_code:b,new_password:d})}async function x(a){let b=new URLSearchParams;a?.page&&b.append("page",a.page.toString()),a?.page_size&&b.append("page_size",a.page_size.toString()),a?.status!==void 0&&b.append("status",a.status.toString()),a?.keyword&&b.append("keyword",a.keyword);let d=b.toString();return r(`${c.ADMINS}${d?`?${d}`:""}`)}async function y(a){return r(`${c.ADMINS}/${a}`)}async function z(a){return q(c.ADMINS,a)}async function A(a,b){return s(`${c.ADMINS}/${a}`,b)}async function B(a){return t(`${c.ADMINS}/${a}`)}async function C(a,b){return q(`${c.ADMINS}/${a}/roles`,{role_ids:b})}async function D(a){let b=new URLSearchParams;a?.page&&b.append("page",a.page.toString()),a?.page_size&&b.append("page_size",a.page_size.toString()),a?.keyword&&b.append("keyword",a.keyword);let d=b.toString();return r(`${c.ROLES}${d?`?${d}`:""}`)}async function E(a){return r(`${c.ROLES}/${a}`)}async function F(a){return q(c.ROLES,a)}async function G(a,b){return s(`${c.ROLES}/${a}`,b)}async function H(a){return t(`${c.ROLES}/${a}`)}async function I(a){let b=new URLSearchParams;a?.page&&b.append("page",a.page.toString()),a?.page_size&&b.append("page_size",a.page_size.toString()),a?.resource_type&&b.append("resource_type",a.resource_type),a?.keyword&&b.append("keyword",a.keyword);let d=b.toString();return r(`${c.PERMISSIONS}${d?`?${d}`:""}`)}async function J(){return r(c.PERMISSIONS_TREE)}async function K(a){return q(c.PERMISSIONS,a)}async function L(a,b){return s(`${c.PERMISSIONS}/${a}`,b)}async function M(a){return t(`${c.PERMISSIONS}/${a}`)}async function N(a,b){return q(`${c.ROLES}/${a}/permissions`,{permission_ids:b})}a.s(["ApiError",()=>d,"assignPermissionsToRole",()=>N,"assignRolesToAdmin",()=>C,"changePassword",()=>v,"clearAccessToken",()=>j,"clearRefreshToken",()=>k,"createAdmin",()=>z,"createPermission",()=>K,"createRole",()=>F,"deleteAdmin",()=>B,"deletePermission",()=>M,"deleteRole",()=>H,"getAccessToken",()=>g,"getAdmin",()=>y,"getAdmins",()=>x,"getPermissions",()=>I,"getPermissionsTree",()=>J,"getRole",()=>E,"getRoles",()=>D,"getSystemInfo",()=>u,"post",()=>p,"postWithAuth",()=>q,"resetPassword",()=>w,"setAccessToken",()=>h,"setRefreshToken",()=>i,"updateAdmin",()=>A,"updatePermission",()=>L,"updateRole",()=>G],53250)},3130,a=>{"use strict";var b=a.i(79393),c=a.i(97895);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card",className:(0,c.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",a),...d})}function e({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-header",className:(0,c.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...d})}function f({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-title",className:(0,c.cn)("leading-none font-semibold",a),...d})}function g({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-description",className:(0,c.cn)("text-muted-foreground text-sm",a),...d})}function h({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-content",className:(0,c.cn)("px-6",a),...d})}function i({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-footer",className:(0,c.cn)("flex items-center px-6 [.border-t]:pt-6",a),...d})}a.s(["Card",()=>d,"CardContent",()=>h,"CardDescription",()=>g,"CardFooter",()=>i,"CardHeader",()=>e,"CardTitle",()=>f])},16474,a=>{"use strict";var b=a.i(79393);a.i(25602);var c=a.i(42261),d=a.i(97895),e=a.i(17171);function f({className:a,...c}){return(0,b.jsx)("div",{"data-slot":"field-group",className:(0,d.cn)("group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4",a),...c})}a.i(7379);let g=(0,c.cva)("group/field flex w-full gap-3 data-[invalid=true]:text-destructive",{variants:{orientation:{vertical:["flex-col [&>*]:w-full [&>.sr-only]:w-auto"],horizontal:["flex-row items-center","[&>[data-slot=field-label]]:flex-auto","has-[>[data-slot=field-content]]:items-start has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px"],responsive:["flex-col [&>*]:w-full [&>.sr-only]:w-auto @md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto","@md/field-group:[&>[data-slot=field-label]]:flex-auto","@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px"]}},defaultVariants:{orientation:"vertical"}});function h({className:a,orientation:c="vertical",...e}){return(0,b.jsx)("div",{role:"group","data-slot":"field","data-orientation":c,className:(0,d.cn)(g({orientation:c}),a),...e})}function i({className:a,...c}){return(0,b.jsx)(e.Label,{"data-slot":"field-label",className:(0,d.cn)("group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50","has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>*]:data-[slot=field]:p-4","has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10",a),...c})}function j({className:a,...c}){return(0,b.jsx)("p",{"data-slot":"field-description",className:(0,d.cn)("text-muted-foreground text-sm leading-normal font-normal group-has-[[data-orientation=horizontal]]/field:text-balance","last:mt-0 nth-last-2:-mt-1 [[data-variant=legend]+&]:-mt-1.5","[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4",a),...c})}a.s(["Field",()=>h,"FieldDescription",()=>j,"FieldGroup",()=>f,"FieldLabel",()=>i])},66383,a=>{"use strict";var b=a.i(79393),c=a.i(25602),d=a.i(54347),e=a.i(40695),f=a.i(3130),g=a.i(16474),h=a.i(38847),i=a.i(53250);function j(){var a;let j=(0,d.useRouter)(),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(null),s=async()=>{l(!0),r(null);try{let a=await (0,i.postWithAuth)(h.API_ENDPOINTS.TWO_FACTOR_SETUP);p(a)}catch(a){a instanceof i.ApiError?r(a.message||"设置 2FA 失败"):r("发生未知错误")}finally{l(!1)}},t=async()=>{n(!0),r(null);try{await (0,i.postWithAuth)(h.API_ENDPOINTS.TWO_FACTOR_DISABLE),j.push("/dashboard")}catch(a){j.push("/dashboard")}finally{n(!1)}};return(0,b.jsx)("div",{className:"w-full",children:(0,b.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,b.jsxs)("div",{className:"flex flex-col items-center gap-1 text-center",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold",children:"设置 2FA 验证"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm text-balance",children:"为您的账户启用双因素认证，提高账户安全性"})]}),!o&&(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)(f.Card,{className:"flex flex-col",children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:"设置 2FA"}),(0,b.jsx)(f.CardDescription,{children:"启用双因素认证以保护您的账户安全"})]}),(0,b.jsx)(f.CardContent,{className:"flex-1",children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"使用 Google Authenticator、Authy 等 TOTP 应用扫描二维码或输入密钥"})}),(0,b.jsx)(f.CardFooter,{children:(0,b.jsx)(e.Button,{type:"button",variant:"default",onClick:s,disabled:k,className:"w-full",children:k?"正在设置...":"设置 2FA"})})]}),(0,b.jsxs)(f.Card,{className:"flex flex-col",children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:"稍后再设置"}),(0,b.jsx)(f.CardDescription,{children:"您可以稍后进入设置页面配置 2FA"})]}),(0,b.jsx)(f.CardContent,{className:"flex-1",children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"您可以在任何时间返回此页面设置 2FA 验证"})}),(0,b.jsx)(f.CardFooter,{children:(0,b.jsx)(e.Button,{type:"button",variant:"outline",onClick:t,disabled:m,className:"w-full",children:m?"跳过中...":"稍后再设置"})})]})]}),q&&(0,b.jsx)("div",{className:"bg-destructive/10 text-destructive text-sm p-3 rounded-md text-center",children:q}),o&&(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)(f.Card,{className:"flex flex-col",children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:"密钥与备用码"}),(0,b.jsx)(f.CardDescription,{children:"请妥善保存这些信息"})]}),(0,b.jsxs)(f.CardContent,{className:"flex-1 flex flex-col gap-4",children:[(0,b.jsxs)(g.Field,{children:[(0,b.jsx)(g.FieldLabel,{children:"密钥 (Secret)"}),(0,b.jsx)(g.FieldDescription,{className:"font-mono text-xs break-all bg-muted p-3 rounded-md",children:o.secret})]}),(0,b.jsxs)(g.Field,{children:[(0,b.jsx)(g.FieldLabel,{children:"备用验证码"}),(0,b.jsx)(g.FieldDescription,{className:"text-xs",children:"每个验证码只能使用一次："}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2 mt-2",children:o.backup_codes.map((a,c)=>(0,b.jsx)("div",{className:"font-mono text-xs bg-muted p-2 rounded-md text-center",children:a},c))})]}),(0,b.jsxs)(g.FieldDescription,{className:"text-xs",children:["⚠️ 重要提示：",(0,b.jsx)("br",{}),"1. 使用 TOTP 应用扫描二维码或手动输入密钥",(0,b.jsx)("br",{}),"2. 备用验证码只能在无法使用 TOTP 应用时使用",(0,b.jsx)("br",{}),"3. 请将备用验证码保存在安全的地方"]})]}),(0,b.jsxs)(f.CardFooter,{className:"flex flex-col gap-2",children:[(0,b.jsx)(e.Button,{type:"button",variant:"default",onClick:()=>{j.push("/dashboard")},className:"w-full",children:"设置完成进入主页"}),(0,b.jsx)(e.Button,{type:"button",variant:"outline",onClick:t,disabled:m,className:"w-full",children:m?"跳过中...":"稍后再设置（会禁用 2FA）"})]})]}),(0,b.jsxs)(f.Card,{className:"flex flex-col",children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:"扫描二维码"}),(0,b.jsx)(f.CardDescription,{children:"使用您的 TOTP 应用扫描"})]}),(0,b.jsx)(f.CardContent,{className:"flex-1",children:(0,b.jsx)("div",{className:"bg-white p-4 rounded-md flex items-center justify-center min-h-[300px]",children:(0,b.jsx)("img",{src:(a=o.qr_code_url).startsWith("data:image")?a:`data:image/png;base64,${a}`,alt:"2FA QR Code",className:"w-full h-auto max-w-[300px]"})})})]})]})]})})}a.s(["Step2FA",()=>j])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__9a44ba6f._.js.map