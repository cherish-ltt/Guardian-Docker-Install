module.exports=[98953,(a,b,c)=>{"use strict";b.exports=a.r(16232).vendored.contexts.AppRouterContext},52529,(a,b,c)=>{"use strict";b.exports=a.r(16232).vendored.contexts.HooksClientContext},88950,(a,b,c)=>{"use strict";b.exports=a.r(16232).vendored.contexts.ServerInsertedHtml},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},79393,(a,b,c)=>{"use strict";b.exports=a.r(16232).vendored["react-ssr"].ReactJsxRuntime},78338,(a,b,c)=>{"use strict";b.exports=a.r(16232).vendored["react-ssr"].ReactServerDOMTurbopackClient},53250,38847,a=>{"use strict";let b="/guardian-auth/v1",c={LOGIN:"/auth/login",LOGOUT:"/auth/logout",REFRESH:"/auth/refresh",TWO_FACTOR_SETUP:"/auth/2fa/setup",TWO_FACTOR_VERIFY:"/auth/2fa/verify",TWO_FACTOR_DISABLE:"/auth/2fa/disable",CHANGE_PASSWORD:"/auth/change-password",RESET_PASSWORD:"/auth/reset-password",SYSTEM_INFO:"/systeminfo",ADMINS:"/admins",ROLES:"/roles",PERMISSIONS:"/permissions",PERMISSIONS_TREE:"/permissions/tree"};a.s(["API_BASE_URL",0,b,"API_ENDPOINTS",0,c],38847);class d extends Error{code;data;constructor(a,b,c){super(b),this.code=a,this.data=c,this.name="ApiError"}}let e=!1,f=null;function g(){return null}function h(a){}function i(a){}function j(){}function k(){}async function l(){throw Error("No refresh token available")}async function m(a){let b=a.headers.get("content-type");if(!a.ok){let b=a.status,c="出错啦！请稍后再试。";try{let b=await a.json();b.msg&&""!==b.msg.trim()&&(c=b.msg)}catch{}throw new d(b,c)}if(!b||!b.includes("application/json"))throw new d(0,"Invalid response format");let c=await a.json();if(200!==c.code){let a=c.msg&&""!==c.msg.trim()?c.msg:"出错啦！请稍后再试。";throw new d(c.code,a,c.data)}return c.data}async function n(a,b,c){let g=a.headers.get("content-type");if(!a.ok){let b=a.status,c="出错啦！请稍后再试。";try{let b=await a.json();b.msg&&""!==b.msg.trim()&&(c=b.msg)}catch{}throw new d(b,c)}if(!g||!g.includes("application/json"))throw new d(0,"Invalid response format");let h=await a.json();if(17003===h.code||17002===h.code)try{let a="";e?a=await f:(e=!0,f=l(),a=await f,f=null,e=!1);let d=await fetch(b,{...c,headers:{...c.headers,Authorization:`Bearer ${a}`}});return m(d)}catch{throw new d(h.code,"Session expired, please login again")}if(200!==h.code){let a=h.msg&&""!==h.msg.trim()?h.msg:"出错啦！请稍后再试。";throw new d(h.code,a,h.data)}return h.data}async function o(a,c){let d=`${b}${a}`,e={"Content-Type":"application/json",...c?.headers};return m(await fetch(d,{...c,headers:e}))}async function p(a,b){return o(a,{method:"POST",body:b?JSON.stringify(b):void 0})}async function q(a,c){let d=g(),e=`${b}${a}`,f={method:"POST",body:c?JSON.stringify(c):void 0,headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}};return n(await fetch(e,f),e,f)}async function r(a){let c=g(),d=`${b}${a}`,e={method:"GET",headers:{Authorization:`Bearer ${c}`}};return n(await fetch(d,e),d,e)}async function s(a,c){let d=g(),e=`${b}${a}`,f={method:"PUT",body:c?JSON.stringify(c):void 0,headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}};return n(await fetch(e,f),e,f)}async function t(a){let c=g(),d=`${b}${a}`,e={method:"DELETE",headers:{Authorization:`Bearer ${c}`}};return n(await fetch(d,e),d,e)}async function u(a){let b=a?`?limit=${a}`:"";return r(`${c.SYSTEM_INFO}${b}`)}async function v(a){return q(c.CHANGE_PASSWORD,{new_password:a})}async function w(a,b,d){return p(c.RESET_PASSWORD,{username:a,two_fa_code:b,new_password:d})}async function x(a){let b=new URLSearchParams;a?.page&&b.append("page",a.page.toString()),a?.page_size&&b.append("page_size",a.page_size.toString()),a?.status!==void 0&&b.append("status",a.status.toString()),a?.keyword&&b.append("keyword",a.keyword);let d=b.toString();return r(`${c.ADMINS}${d?`?${d}`:""}`)}async function y(a){return r(`${c.ADMINS}/${a}`)}async function z(a){return q(c.ADMINS,a)}async function A(a,b){return s(`${c.ADMINS}/${a}`,b)}async function B(a){return t(`${c.ADMINS}/${a}`)}async function C(a,b){return q(`${c.ADMINS}/${a}/roles`,{role_ids:b})}async function D(a){let b=new URLSearchParams;a?.page&&b.append("page",a.page.toString()),a?.page_size&&b.append("page_size",a.page_size.toString()),a?.keyword&&b.append("keyword",a.keyword);let d=b.toString();return r(`${c.ROLES}${d?`?${d}`:""}`)}async function E(a){return r(`${c.ROLES}/${a}`)}async function F(a){return q(c.ROLES,a)}async function G(a,b){return s(`${c.ROLES}/${a}`,b)}async function H(a){return t(`${c.ROLES}/${a}`)}async function I(a){let b=new URLSearchParams;a?.page&&b.append("page",a.page.toString()),a?.page_size&&b.append("page_size",a.page_size.toString()),a?.resource_type&&b.append("resource_type",a.resource_type),a?.keyword&&b.append("keyword",a.keyword);let d=b.toString();return r(`${c.PERMISSIONS}${d?`?${d}`:""}`)}async function J(){return r(c.PERMISSIONS_TREE)}async function K(a){return q(c.PERMISSIONS,a)}async function L(a,b){return s(`${c.PERMISSIONS}/${a}`,b)}async function M(a){return t(`${c.PERMISSIONS}/${a}`)}async function N(a,b){return q(`${c.ROLES}/${a}/permissions`,{permission_ids:b})}a.s(["ApiError",()=>d,"assignPermissionsToRole",()=>N,"assignRolesToAdmin",()=>C,"changePassword",()=>v,"clearAccessToken",()=>j,"clearRefreshToken",()=>k,"createAdmin",()=>z,"createPermission",()=>K,"createRole",()=>F,"deleteAdmin",()=>B,"deletePermission",()=>M,"deleteRole",()=>H,"getAccessToken",()=>g,"getAdmin",()=>y,"getAdmins",()=>x,"getPermissions",()=>I,"getPermissionsTree",()=>J,"getRole",()=>E,"getRoles",()=>D,"getSystemInfo",()=>u,"post",()=>p,"postWithAuth",()=>q,"resetPassword",()=>w,"setAccessToken",()=>h,"setRefreshToken",()=>i,"updateAdmin",()=>A,"updatePermission",()=>L,"updateRole",()=>G],53250)},54161,88237,a=>{"use strict";var b=a.i(79393),c=a.i(52257),d=a.i(42261),e=a.i(97895);let f=(0,d.cva)("inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function g({className:a,variant:d,asChild:g=!1,...h}){let i=g?c.Slot:"span";return(0,b.jsx)(i,{"data-slot":"badge",className:(0,e.cn)(f({variant:d}),a),...h})}function h({className:a,...c}){return(0,b.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,b.jsx)("table",{"data-slot":"table",className:(0,e.cn)("w-full caption-bottom text-sm",a),...c})})}function i({className:a,...c}){return(0,b.jsx)("thead",{"data-slot":"table-header",className:(0,e.cn)("[&_tr]:border-b",a),...c})}function j({className:a,...c}){return(0,b.jsx)("tbody",{"data-slot":"table-body",className:(0,e.cn)("[&_tr:last-child]:border-0",a),...c})}function k({className:a,...c}){return(0,b.jsx)("tr",{"data-slot":"table-row",className:(0,e.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",a),...c})}function l({className:a,...c}){return(0,b.jsx)("th",{"data-slot":"table-head",className:(0,e.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...c})}function m({className:a,...c}){return(0,b.jsx)("td",{"data-slot":"table-cell",className:(0,e.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...c})}a.s(["Badge",()=>g],54161),a.s(["Table",()=>h,"TableBody",()=>j,"TableCell",()=>m,"TableHead",()=>l,"TableHeader",()=>i,"TableRow",()=>k],88237)},54653,a=>{"use strict";var b=a.i(79393),c=a.i(25602),d=a.i(54347),e=a.i(39793),f=a.i(91302),g=a.i(14727),h=a.i(40695),i=a.i(54161),j=a.i(88237),k=a.i(5522),l=a.i(17171),m=a.i(65733),n=a.i(87682),o=a.i(37258),p=a.i(53250);function q(){let a=(0,d.useRouter)(),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(0),[w,x]=(0,c.useState)(1),[y,z]=(0,c.useState)(20),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)("create"),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)({code:"",name:"",description:"",resource_type:"",http_method:"",resource_path:""}),[M,N]=(0,c.useState)(!1);(0,c.useEffect)(()=>{if(!(0,p.getAccessToken)())return void a.push("/login")},[a]);let O=async()=>{t(!0);try{let a=await (0,p.getPermissions)({page:w,page_size:y,keyword:A||void 0,resource_type:C||void 0});r(a.list),v(a.total)}catch(a){a instanceof p.ApiError?o.toast.error(a.message||"获取权限列表失败"):o.toast.error("发生未知错误，请稍后重试")}finally{t(!1)}};(0,c.useEffect)(()=>{(0,p.getAccessToken)()&&O()},[w,y,A,C]);let P=async(a,b)=>{if(confirm(`确定要删除权限 "${b}" 吗？`))try{await (0,p.deletePermission)(a),o.toast.success("删除成功"),O()}catch(a){a instanceof p.ApiError?o.toast.error(a.message||"删除失败"):o.toast.error("发生未知错误，请稍后重试")}},Q=async a=>{if(a.preventDefault(),!K.code)return void o.toast.error("权限代码不能为空");if(!K.name)return void o.toast.error("权限名称不能为空");if(K.code.length<2)return void o.toast.error("权限代码至少为 2 位");if(K.name.length<2)return void o.toast.error("权限名称至少为 2 个字符");if(K.resource_type&&"api"!==K.resource_type&&"menu"!==K.resource_type&&"button"!==K.resource_type)return void o.toast.error("资源类型必须是 api、menu 或 button");N(!0);try{if("create"===G)await (0,p.createPermission)({code:K.code,name:K.name,description:K.description,resource_type:K.resource_type,http_method:K.http_method,resource_path:K.resource_path}),o.toast.success("创建成功");else if("edit"===G&&I){let a={name:K.name,description:K.description,resource_type:K.resource_type,http_method:K.http_method,resource_path:K.resource_path};void 0!==K.sort_order&&(a.sort_order=K.sort_order),await (0,p.updatePermission)(I.id,a),o.toast.success("更新成功")}F(!1),L({code:"",name:"",description:"",resource_type:"",http_method:"",resource_path:""}),O()}catch(a){a instanceof p.ApiError?o.toast.error(a.message||("create"===G?"创建失败":"更新失败")):o.toast.error("发生未知错误，请稍后重试")}finally{N(!1)}},R=Math.ceil(u/y);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(g.SidebarProvider,{style:{"--sidebar-width":"calc(var(--spacing) * 72)","--header-height":"calc(var(--spacing) * 12)"},children:[(0,b.jsx)(e.AppSidebar,{variant:"inset"}),(0,b.jsxs)(g.SidebarInset,{children:[(0,b.jsx)(f.SiteHeader,{}),(0,b.jsx)("div",{className:"flex flex-1 flex-col",children:(0,b.jsx)("div",{className:"@container/main flex flex-1 flex-col gap-2",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 px-4 py-4 lg:px-6 lg:py-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold",children:"权限管理"}),(0,b.jsx)(h.Button,{onClick:()=>{H("create"),J(null),L({code:"",name:"",description:"",resource_type:"",http_method:"",resource_path:""}),F(!0)},children:"添加权限"})]}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"keyword",children:"搜索"}),(0,b.jsx)(k.Input,{id:"keyword",value:A,onChange:a=>B(a.target.value),placeholder:"权限名称或代码",className:"w-48"}),(0,b.jsx)(h.Button,{onClick:()=>{x(1),O()},disabled:s,children:"搜索"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Label,{htmlFor:"resourceType",children:"资源类型"}),(0,b.jsxs)(n.Select,{value:C||"all",onValueChange:a=>D("all"===a?"":a),children:[(0,b.jsx)(n.SelectTrigger,{className:"w-32",children:(0,b.jsx)(n.SelectValue,{placeholder:"全部"})}),(0,b.jsxs)(n.SelectContent,{children:[(0,b.jsx)(n.SelectItem,{value:"all",children:"全部"}),(0,b.jsx)(n.SelectItem,{value:"api",children:"API"}),(0,b.jsx)(n.SelectItem,{value:"menu",children:"菜单"}),(0,b.jsx)(n.SelectItem,{value:"button",children:"按钮"})]})]})]})]}),(0,b.jsx)("div",{className:"rounded-lg border",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"权限代码"}),(0,b.jsx)(j.TableHead,{children:"权限名称"}),(0,b.jsx)(j.TableHead,{children:"资源类型"}),(0,b.jsx)(j.TableHead,{children:"操作"})]})}),(0,b.jsx)(j.TableBody,{children:s?(0,b.jsx)(j.TableRow,{children:(0,b.jsx)(j.TableCell,{colSpan:4,className:"text-center",children:"加载中..."})}):0===q.length?(0,b.jsx)(j.TableRow,{children:(0,b.jsx)(j.TableCell,{colSpan:4,className:"text-center",children:"暂无数据"})}):q.map(a=>(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"font-medium",children:a.code}),(0,b.jsx)(j.TableCell,{children:a.name}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(i.Badge,{variant:"secondary",children:a.resource_type||"-"})}),(0,b.jsx)(j.TableCell,{children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>{H("edit"),J(a),L({code:a.code,name:a.name,description:a.description||"",resource_type:a.resource_type||"",http_method:a.http_method||"",resource_path:a.resource_path||""}),F(!0)},children:"编辑"}),(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>P(a.id,a.name),children:"删除"})]})})]},a.id))})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["共 ",u," 条记录，当前第 ",w," / ",R," 页"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>x(a=>Math.max(1,a-1)),disabled:s||w<=1,children:"上一页"}),(0,b.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>x(a=>Math.min(R,a+1)),disabled:s||w>=R,children:"下一页"})]})]})]})})})]})]}),(0,b.jsx)(m.Dialog,{open:E,onOpenChange:F,children:(0,b.jsxs)(m.DialogContent,{children:[(0,b.jsxs)(m.DialogHeader,{children:[(0,b.jsx)(m.DialogTitle,{children:"create"===G?"添加权限":"编辑权限"}),(0,b.jsx)(m.DialogDescription,{children:"create"===G?"请填写权限信息":"请更新权限信息"})]}),(0,b.jsxs)("form",{onSubmit:Q,children:[(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"code",children:"权限代码 *"}),(0,b.jsx)(k.Input,{id:"code",value:K.code,onChange:a=>L({...K,code:a.target.value}),placeholder:"请输入权限代码（如 API_USER_CREATE）",required:!0,disabled:M||"edit"===G})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"name",children:"权限名称 *"}),(0,b.jsx)(k.Input,{id:"name",value:K.name,onChange:a=>L({...K,name:a.target.value}),placeholder:"请输入权限名称",required:!0,disabled:M})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"description",children:"描述"}),(0,b.jsx)(k.Input,{id:"description",value:K.description,onChange:a=>L({...K,description:a.target.value}),placeholder:"请输入权限描述（可选）",disabled:M,maxLength:200})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"resource_type",children:"资源类型"}),(0,b.jsxs)(n.Select,{value:K.resource_type,onValueChange:a=>L({...K,resource_type:a}),children:[(0,b.jsx)(n.SelectTrigger,{id:"resource_type",children:(0,b.jsx)(n.SelectValue,{placeholder:"请选择资源类型"})}),(0,b.jsxs)(n.SelectContent,{children:[(0,b.jsx)(n.SelectItem,{value:"api",children:"API"}),(0,b.jsx)(n.SelectItem,{value:"menu",children:"菜单"}),(0,b.jsx)(n.SelectItem,{value:"button",children:"按钮"})]})]})]}),"api"===K.resource_type&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"http_method",children:"HTTP 方法"}),(0,b.jsxs)(n.Select,{value:K.http_method,onValueChange:a=>L({...K,http_method:a}),children:[(0,b.jsx)(n.SelectTrigger,{id:"http_method",children:(0,b.jsx)(n.SelectValue,{placeholder:"请选择HTTP方法"})}),(0,b.jsxs)(n.SelectContent,{children:[(0,b.jsx)(n.SelectItem,{value:"GET",children:"GET"}),(0,b.jsx)(n.SelectItem,{value:"POST",children:"POST"}),(0,b.jsx)(n.SelectItem,{value:"PUT",children:"PUT"}),(0,b.jsx)(n.SelectItem,{value:"DELETE",children:"DELETE"}),(0,b.jsx)(n.SelectItem,{value:"PATCH",children:"PATCH"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"resource_path",children:"资源路径"}),(0,b.jsx)(k.Input,{id:"resource_path",value:K.resource_path,onChange:a=>L({...K,resource_path:a.target.value}),placeholder:"例如: /api/v1/users",disabled:M})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"sort_order",children:"排序（可选）"}),(0,b.jsx)(k.Input,{id:"sort_order",type:"number",value:K.sort_order||"",onChange:a=>L({...K,sort_order:a.target.value?parseInt(a.target.value):void 0}),placeholder:"请输入排序值，数字越小越靠前",disabled:M})]})]}),(0,b.jsxs)(m.DialogFooter,{children:[(0,b.jsx)(h.Button,{type:"button",variant:"outline",onClick:()=>F(!1),disabled:M,children:"取消"}),(0,b.jsx)(h.Button,{type:"submit",disabled:M,children:M?"create"===G?"创建中...":"更新中...":"create"===G?"确认创建":"确认更新"})]})]})]})})]})}a.s(["default",()=>q])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__53691d79._.js.map