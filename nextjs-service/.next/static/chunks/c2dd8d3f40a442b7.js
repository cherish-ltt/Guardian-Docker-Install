(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,54858,61664,e=>{"use strict";e.i(34702);let t="/guardian-auth/v1",a={LOGIN:"/auth/login",LOGOUT:"/auth/logout",REFRESH:"/auth/refresh",TWO_FACTOR_SETUP:"/auth/2fa/setup",TWO_FACTOR_VERIFY:"/auth/2fa/verify",TWO_FACTOR_DISABLE:"/auth/2fa/disable",CHANGE_PASSWORD:"/auth/change-password",RESET_PASSWORD:"/auth/reset-password",SYSTEM_INFO:"/systeminfo",ADMINS:"/admins",ROLES:"/roles",PERMISSIONS:"/permissions",PERMISSIONS_TREE:"/permissions/tree"};e.s(["API_BASE_URL",0,t,"API_ENDPOINTS",0,a],61664);class r extends Error{code;data;constructor(e,t,a){super(t),this.code=e,this.data=a,this.name="ApiError"}}let s=!1,n=null;function o(){return localStorage.getItem("access_token")}function i(e){localStorage.setItem("access_token",e),document.cookie=`access_token=${e}; path=/; max-age=900; SameSite=Lax`}function l(e){localStorage.setItem("refresh_token",e)}function d(){localStorage.removeItem("access_token"),document.cookie="access_token=; path=/; max-age=0"}function c(){localStorage.removeItem("refresh_token")}async function u(){let e=localStorage.getItem("refresh_token");if(!e)throw Error("No refresh token available");try{let r=await fetch(`${t}${a.REFRESH}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e})}),s=await r.json();if(200!==s.code)throw d(),c(),window.location.href="/login",Error("Token refresh failed");return i(s.data.access_token),s.data.access_token}catch(e){throw d(),c(),window.location.href="/login",e}}async function f(e){let t=e.headers.get("content-type");if(!e.ok){let t=e.status,a="出错啦！请稍后再试。";try{let t=await e.json();t.msg&&""!==t.msg.trim()&&(a=t.msg)}catch{}throw new r(t,a)}if(!t||!t.includes("application/json"))throw new r(0,"Invalid response format");let a=await e.json();if(200!==a.code){let e=a.msg&&""!==a.msg.trim()?a.msg:"出错啦！请稍后再试。";throw new r(a.code,e,a.data)}return a.data}async function p(e,t,a){let o=e.headers.get("content-type");if(!e.ok){let t=e.status,a="出错啦！请稍后再试。";try{let t=await e.json();t.msg&&""!==t.msg.trim()&&(a=t.msg)}catch{}throw new r(t,a)}if(!o||!o.includes("application/json"))throw new r(0,"Invalid response format");let i=await e.json();if(17003===i.code||17002===i.code)try{let e="";s?e=await n:(s=!0,n=u(),e=await n,n=null,s=!1);let r=await fetch(t,{...a,headers:{...a.headers,Authorization:`Bearer ${e}`}});return f(r)}catch{throw window.location.href="/login",new r(i.code,"Session expired, please login again")}if(200!==i.code){let e=i.msg&&""!==i.msg.trim()?i.msg:"出错啦！请稍后再试。";throw new r(i.code,e,i.data)}return i.data}async function h(e,a){let r=`${t}${e}`,s={"Content-Type":"application/json",...a?.headers};return f(await fetch(r,{...a,headers:s}))}async function m(e,t){return h(e,{method:"POST",body:t?JSON.stringify(t):void 0})}async function x(e,a){let r=o(),s=`${t}${e}`,n={method:"POST",body:a?JSON.stringify(a):void 0,headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}};return p(await fetch(s,n),s,n)}async function g(e){let a=o(),r=`${t}${e}`,s={method:"GET",headers:{Authorization:`Bearer ${a}`}};return p(await fetch(r,s),r,s)}async function S(e,a){let r=o(),s=`${t}${e}`,n={method:"PUT",body:a?JSON.stringify(a):void 0,headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}};return p(await fetch(s,n),s,n)}async function y(e){let a=o(),r=`${t}${e}`,s={method:"DELETE",headers:{Authorization:`Bearer ${a}`}};return p(await fetch(r,s),r,s)}async function w(e){let t=e?`?limit=${e}`:"";return g(`${a.SYSTEM_INFO}${t}`)}async function j(e){return x(a.CHANGE_PASSWORD,{new_password:e})}async function N(e,t,r){return m(a.RESET_PASSWORD,{username:e,two_fa_code:t,new_password:r})}async function A(e){let t=new URLSearchParams;e?.page&&t.append("page",e.page.toString()),e?.page_size&&t.append("page_size",e.page_size.toString()),e?.status!==void 0&&t.append("status",e.status.toString()),e?.keyword&&t.append("keyword",e.keyword);let r=t.toString();return g(`${a.ADMINS}${r?`?${r}`:""}`)}async function T(e){return g(`${a.ADMINS}/${e}`)}async function _(e){return x(a.ADMINS,e)}async function b(e,t){return S(`${a.ADMINS}/${e}`,t)}async function C(e){return y(`${a.ADMINS}/${e}`)}async function $(e,t){return x(`${a.ADMINS}/${e}/roles`,{role_ids:t})}async function v(e){let t=new URLSearchParams;e?.page&&t.append("page",e.page.toString()),e?.page_size&&t.append("page_size",e.page_size.toString()),e?.keyword&&t.append("keyword",e.keyword);let r=t.toString();return g(`${a.ROLES}${r?`?${r}`:""}`)}async function E(e){return g(`${a.ROLES}/${e}`)}async function O(e){return x(a.ROLES,e)}async function R(e,t){return S(`${a.ROLES}/${e}`,t)}async function k(e){return y(`${a.ROLES}/${e}`)}async function I(e){let t=new URLSearchParams;e?.page&&t.append("page",e.page.toString()),e?.page_size&&t.append("page_size",e.page_size.toString()),e?.resource_type&&t.append("resource_type",e.resource_type),e?.keyword&&t.append("keyword",e.keyword);let r=t.toString();return g(`${a.PERMISSIONS}${r?`?${r}`:""}`)}async function P(){return g(a.PERMISSIONS_TREE)}async function F(e){return x(a.PERMISSIONS,e)}async function D(e,t){return S(`${a.PERMISSIONS}/${e}`,t)}async function L(e){return y(`${a.PERMISSIONS}/${e}`)}async function z(e,t){return x(`${a.ROLES}/${e}/permissions`,{permission_ids:t})}e.s(["ApiError",()=>r,"assignPermissionsToRole",()=>z,"assignRolesToAdmin",()=>$,"changePassword",()=>j,"clearAccessToken",()=>d,"clearRefreshToken",()=>c,"createAdmin",()=>_,"createPermission",()=>F,"createRole",()=>O,"deleteAdmin",()=>C,"deletePermission",()=>L,"deleteRole",()=>k,"getAccessToken",()=>o,"getAdmin",()=>T,"getAdmins",()=>A,"getPermissions",()=>I,"getPermissionsTree",()=>P,"getRole",()=>E,"getRoles",()=>v,"getSystemInfo",()=>w,"post",()=>m,"postWithAuth",()=>x,"resetPassword",()=>N,"setAccessToken",()=>i,"setRefreshToken",()=>l,"updateAdmin",()=>b,"updatePermission",()=>D,"updateRole",()=>R],54858)},4520,(e,t,a)=>{t.exports=e.r(26841)},70065,e=>{"use strict";var t=e.i(83638),a=e.i(47163);function r({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...r})}function s({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...r})}function n({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...r})}function o({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",e),...r})}function i({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...r})}function l({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-footer",className:(0,a.cn)("flex items-center px-6 [.border-t]:pt-6",e),...r})}e.s(["Card",()=>r,"CardContent",()=>i,"CardDescription",()=>o,"CardFooter",()=>l,"CardHeader",()=>s,"CardTitle",()=>n])},86530,e=>{"use strict";var t=e.i(83638);e.i(43447);var a=e.i(94237),r=e.i(47163),s=e.i(10708);function n({className:e,...a}){return(0,t.jsx)("div",{"data-slot":"field-group",className:(0,r.cn)("group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4",e),...a})}e.i(69035);let o=(0,a.cva)("group/field flex w-full gap-3 data-[invalid=true]:text-destructive",{variants:{orientation:{vertical:["flex-col [&>*]:w-full [&>.sr-only]:w-auto"],horizontal:["flex-row items-center","[&>[data-slot=field-label]]:flex-auto","has-[>[data-slot=field-content]]:items-start has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px"],responsive:["flex-col [&>*]:w-full [&>.sr-only]:w-auto @md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto","@md/field-group:[&>[data-slot=field-label]]:flex-auto","@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px"]}},defaultVariants:{orientation:"vertical"}});function i({className:e,orientation:a="vertical",...s}){return(0,t.jsx)("div",{role:"group","data-slot":"field","data-orientation":a,className:(0,r.cn)(o({orientation:a}),e),...s})}function l({className:e,...a}){return(0,t.jsx)(s.Label,{"data-slot":"field-label",className:(0,r.cn)("group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50","has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>*]:data-[slot=field]:p-4","has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10",e),...a})}function d({className:e,...a}){return(0,t.jsx)("p",{"data-slot":"field-description",className:(0,r.cn)("text-muted-foreground text-sm leading-normal font-normal group-has-[[data-orientation=horizontal]]/field:text-balance","last:mt-0 nth-last-2:-mt-1 [[data-variant=legend]+&]:-mt-1.5","[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4",e),...a})}e.s(["Field",()=>i,"FieldDescription",()=>d,"FieldGroup",()=>n,"FieldLabel",()=>l])},55385,e=>{"use strict";var t=e.i(83638),a=e.i(43447),r=e.i(4520),s=e.i(67881),n=e.i(70065),o=e.i(86530),i=e.i(61664),l=e.i(54858);function d(){var e;let d=(0,r.useRouter)(),[c,u]=(0,a.useState)(!1),[f,p]=(0,a.useState)(!1),[h,m]=(0,a.useState)(null),[x,g]=(0,a.useState)(null),S=async()=>{u(!0),g(null);try{let e=await (0,l.postWithAuth)(i.API_ENDPOINTS.TWO_FACTOR_SETUP);m(e)}catch(e){e instanceof l.ApiError?g(e.message||"设置 2FA 失败"):g("发生未知错误")}finally{u(!1)}},y=async()=>{p(!0),g(null);try{await (0,l.postWithAuth)(i.API_ENDPOINTS.TWO_FACTOR_DISABLE),d.push("/dashboard")}catch(e){d.push("/dashboard")}finally{p(!1)}};return(0,t.jsx)("div",{className:"w-full",children:(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1 text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"设置 2FA 验证"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm text-balance",children:"为您的账户启用双因素认证，提高账户安全性"})]}),!h&&(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)(n.Card,{className:"flex flex-col",children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsx)(n.CardTitle,{children:"设置 2FA"}),(0,t.jsx)(n.CardDescription,{children:"启用双因素认证以保护您的账户安全"})]}),(0,t.jsx)(n.CardContent,{className:"flex-1",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"使用 Google Authenticator、Authy 等 TOTP 应用扫描二维码或输入密钥"})}),(0,t.jsx)(n.CardFooter,{children:(0,t.jsx)(s.Button,{type:"button",variant:"default",onClick:S,disabled:c,className:"w-full",children:c?"正在设置...":"设置 2FA"})})]}),(0,t.jsxs)(n.Card,{className:"flex flex-col",children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsx)(n.CardTitle,{children:"稍后再设置"}),(0,t.jsx)(n.CardDescription,{children:"您可以稍后进入设置页面配置 2FA"})]}),(0,t.jsx)(n.CardContent,{className:"flex-1",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"您可以在任何时间返回此页面设置 2FA 验证"})}),(0,t.jsx)(n.CardFooter,{children:(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:y,disabled:f,className:"w-full",children:f?"跳过中...":"稍后再设置"})})]})]}),x&&(0,t.jsx)("div",{className:"bg-destructive/10 text-destructive text-sm p-3 rounded-md text-center",children:x}),h&&(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)(n.Card,{className:"flex flex-col",children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsx)(n.CardTitle,{children:"密钥与备用码"}),(0,t.jsx)(n.CardDescription,{children:"请妥善保存这些信息"})]}),(0,t.jsxs)(n.CardContent,{className:"flex-1 flex flex-col gap-4",children:[(0,t.jsxs)(o.Field,{children:[(0,t.jsx)(o.FieldLabel,{children:"密钥 (Secret)"}),(0,t.jsx)(o.FieldDescription,{className:"font-mono text-xs break-all bg-muted p-3 rounded-md",children:h.secret})]}),(0,t.jsxs)(o.Field,{children:[(0,t.jsx)(o.FieldLabel,{children:"备用验证码"}),(0,t.jsx)(o.FieldDescription,{className:"text-xs",children:"每个验证码只能使用一次："}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2 mt-2",children:h.backup_codes.map((e,a)=>(0,t.jsx)("div",{className:"font-mono text-xs bg-muted p-2 rounded-md text-center",children:e},a))})]}),(0,t.jsxs)(o.FieldDescription,{className:"text-xs",children:["⚠️ 重要提示：",(0,t.jsx)("br",{}),"1. 使用 TOTP 应用扫描二维码或手动输入密钥",(0,t.jsx)("br",{}),"2. 备用验证码只能在无法使用 TOTP 应用时使用",(0,t.jsx)("br",{}),"3. 请将备用验证码保存在安全的地方"]})]}),(0,t.jsxs)(n.CardFooter,{className:"flex flex-col gap-2",children:[(0,t.jsx)(s.Button,{type:"button",variant:"default",onClick:()=>{d.push("/dashboard")},className:"w-full",children:"设置完成进入主页"}),(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:y,disabled:f,className:"w-full",children:f?"跳过中...":"稍后再设置（会禁用 2FA）"})]})]}),(0,t.jsxs)(n.Card,{className:"flex flex-col",children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsx)(n.CardTitle,{children:"扫描二维码"}),(0,t.jsx)(n.CardDescription,{children:"使用您的 TOTP 应用扫描"})]}),(0,t.jsx)(n.CardContent,{className:"flex-1",children:(0,t.jsx)("div",{className:"bg-white p-4 rounded-md flex items-center justify-center min-h-[300px]",children:(0,t.jsx)("img",{src:(e=h.qr_code_url).startsWith("data:image")?e:`data:image/png;base64,${e}`,alt:"2FA QR Code",className:"w-full h-auto max-w-[300px]"})})})]})]})]})})}e.s(["Step2FA",()=>d])}]);